<script>
  (function () {
    function initLogoLine() {
      const root =
        document.querySelector('.testartem .logo-line') || document.querySelector('.logo-line');
      if (!root) return;

      const viewport = root.querySelector('.logo-line__viewport');
      const track = root.querySelector('.logo-line__track');
      const logoList = root.querySelector('.logo-line__list');
      if (!viewport || !track || !logoList) return;

      const SPEED = 80; // px/sec
      let clone = track.querySelector('.logo-line__list[data-clone="1"]');

      // створюємо клон один раз
      if (!clone) {
        clone = logoList.cloneNode(true);
        clone.setAttribute('data-clone', '1');
        track.appendChild(clone);
      }

      const measure = () => {
        const distance = logoList.getBoundingClientRect().width;
        if (!distance) return;

        root.style.setProperty('--marquee-distance', `${distance}px`);
        root.style.setProperty('--marquee-duration', `${distance / SPEED}s`);
      };

      // чекаємо завантаження всіх логотипів
      const imgs = [...root.querySelectorAll('img')];
      const waitImages = Promise.all(
        imgs.map((img) =>
          img.complete
            ? Promise.resolve()
            : new Promise((res) => {
                img.addEventListener('load', res, { once: true });
                img.addEventListener('error', res, { once: true });
              }),
        ),
      );

      waitImages.then(measure);

      // якщо змінюється ширина (resize / responsive)
      const ro = new ResizeObserver(() => {
        clearTimeout(measure._t);
        measure._t = setTimeout(measure, 120);
      });

      ro.observe(viewport);
      ro.observe(logoList);

      window.addEventListener('resize', () => {
        clearTimeout(measure._t);
        measure._t = setTimeout(measure, 150);
      });
    }

    function tryInit() {
      try {
        initLogoLine();
      } catch (error) {
        console.error('Logo line initialization error:', error);
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', tryInit);
    } else {
      tryInit();
    }

    // Retry mechanism for Webflow
    setTimeout(tryInit, 100);
    setTimeout(tryInit, 500);
    setTimeout(tryInit, 1000);
    setTimeout(tryInit, 2000);
  })();
</script>
